stages:
  - sync

variables:
  # 设置这些变量在GitLab项目的CI/CD设置中
  # Settings → CI/CD → Variables
  GITHUB_TOKEN: $GITHUB_TOKEN
  SYNC_BRANCH: "master"

sync-to-github:
  stage: sync
  image:
    name: 10.144.233.86:8082/sang/bitnami/git:latest
    pull_policy: if-not-present  # 添加这行
  tags:
    - docker
  script:
    - |
      # 添加GitHub远程仓库
      git fetch https://houxiaoyi0722:${GITHUB_TOKEN}@github.com/houxiaoyi0722/cashbook_app.git
      
      # 推送到GitHub
      git push -f https://houxiaoyi0722:${GITHUB_TOKEN}@github.com/houxiaoyi0722/cashbook_app.git HEAD:main
  rules:
    - if: $CI_COMMIT_BRANCH == $SYNC_BRANCH
      when: always
  retry:
    max: 2
