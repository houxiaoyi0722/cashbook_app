stages:
  - sync

variables:
  # 设置这些变量在GitLab项目的CI/CD设置中
  # Settings → CI/CD → Variables
  GITHUB_TOKEN: $GITHUB_TOKEN
  SYNC_BRANCH: "main"

sync-to-github:
  stage: sync
  image: alpine:latest
  tags:
    - docker
  before_script:
    - apk add --no-cache git openssh-client
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - ssh-keyscan github.com >> ~/.ssh/known_hosts
  script:
    - |
      # 添加GitHub远程仓库
      git fetch https://houxiaoyi0722:${GITHUB_TOKEN}@github.com/houxiaoyi0722/cashbook_app.git
      
      # 推送到GitHub
      git push -f https://houxiaoyi0722:${GITHUB_TOKEN}@github.com/houxiaoyi0722/cashbook_app.git HEAD:main
  rules:
    - if: $CI_COMMIT_BRANCH == $SYNC_BRANCH